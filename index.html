<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Star Case Mini App</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º SDK Telegram -->
    <script src="https://telegram.org"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #0f0f0f;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .case-container {
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, #2c3e50 0%, #000000 100%);
            border: 2px solid #f39c12;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(243, 156, 18, 0.3);
            transition: transform 0.3s;
        }

        .case-container.shake {
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            50% { transform: rotate(0eg); }
            75% { transform: rotate(-5deg); }
            100% { transform: rotate(0deg); }
        }

        .btn {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            border: none;
            padding: 15px 40px;
            color: white;
            font-size: 18px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .btn:disabled { background: #555; opacity: 0.6; }

        .reward-text {
            margin-top: 20px;
            font-size: 20px;
            font-weight: bold;
            color: #2ecc71;
            min-height: 24px;
        }
    </style>
</head>
<body>

    <div class="case-container" id="case">üì¶</div>
    <div id="reward" class="reward-text"></div>
    <br>
    <button class="btn" id="buyBtn" onclick="startProcess()">–û—Ç–∫—Ä—ã—Ç—å –∑–∞ 50 ‚≠ê</button>

    <script>
        const tg = window.Telegram.WebApp;
        const BOT_TOKEN = '8424702398:AAEZcihXkIAq3ORxKbXiAls3XH6yl2t1QGM'; // –í–°–¢–ê–í–¨–¢–ï –°–Æ–î–ê –¢–û–ö–ï–ù
        
        tg.ready();
        tg.expand();

        const caseEl = document.getElementById('case');
        const rewardEl = document.getElementById('reward');
        const buyBtn = document.getElementById('buyBtn');

        async function startProcess() {
            rewardEl.innerText = "";
            buyBtn.disabled = true;
            
            try {
                // 1. –°–æ–∑–¥–∞–µ–º —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É —á–µ—Ä–µ–∑ API Telegram
                const invoiceData = {
                    title: "–ú–∞–≥–∏—á–µ—Å–∫–∏–π –ö–µ–π—Å",
                    description: "–ü–æ–ª—É—á–∏—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–∏–∑ –≤–Ω—É—Ç—Ä–∏!",
                    payload: "user_id_" + tg.initDataUnsafe.user?.id,
                    currency: "XTR", // –ö–æ–¥ –¥–ª—è Telegram Stars
                    prices: [{ label: "–ö–µ–π—Å", amount: 50 }]
                };

                const response = await fetch(`https://api.telegram.org{BOT_TOKEN}/createInvoiceLink`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(invoiceData)
                });

                const result = await response.json();

                if (result.ok) {
                    // 2. –û—Ç–∫—Ä—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω–æ–µ –æ–∫–Ω–æ –æ–ø–ª–∞—Ç—ã
                    tg.openInvoice(result.result, (status) => {
                        if (status === 'paid') {
                            openCase();
                        } else {
                            tg.showAlert("–û–ø–ª–∞—Ç–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞");
                            buyBtn.disabled = false;
                        }
                    });
                } else {
                    tg.showAlert("–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å—á–µ—Ç–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ BOT_TOKEN");
                    buyBtn.disabled = false;
                }
            } catch (e) {
                tg.showAlert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: " + e.message);
                buyBtn.disabled = false;
            }
        }

        function openCase() {
            caseEl.classList.add('shake');
            caseEl.innerText = "‚è≥";
            
            // –ò–º–∏—Ç–∞—Ü–∏—è "–æ—Ç–∫—Ä—ã—Ç–∏—è" 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                caseEl.classList.remove('shake');
                const items = ["üíé –ê–ª–º–∞–∑", "üí∞ 1000 –ú–æ–Ω–µ—Ç", "üî• –°—É–ø–µ—Ä-—Å–∏–ª–∞", "üÉè –†–µ–¥–∫–∞—è –∫–∞—Ä—Ç–∞"];
                const win = items[Math.floor(Math.random() * items.length)];
                
                caseEl.innerText = "üéÅ";
                rewardEl.innerText = "–í–∞–º –≤—ã–ø–∞–ª–æ: " + win;
                buyBtn.disabled = false;
                tg.HapticFeedback.notificationOccurred('success');
            }, 2000);
        }
    </script>
</body>
</html>
