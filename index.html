<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT STARS - Trading</title>
    <script src="https://telegram.org"></script>
    <style>
        :root { --bg: #0b0e11; --accent: #fcd535; --card: #1e2329; }
        body { font-family: sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .header { width: 100%; display: flex; justify-content: space-between; align-items: center; }
        .balance-box { background: var(--card); padding: 10px 20px; border-radius: 15px; border: 1px solid var(--accent); font-weight: bold; }
        
        .chest-container { margin: 40px 0; text-align: center; }
        .chest { font-size: 80px; transition: 0.3s; cursor: pointer; }
        .shake { animation: shake 0.5s infinite; }
        @keyframes shake { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }

        .btn-open { background: var(--accent); color: black; border: none; padding: 18px; border-radius: 15px; font-weight: bold; width: 100%; font-size: 16px; }

        /* –û–∫–Ω–æ –≤—ã–∏–≥—Ä—ã—à–∞ */
        #modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            flex-direction: column; align-items: center; justify-content: center; z-index: 100; padding: 20px;
        }
        .win-card { background: var(--card); padding: 30px; border-radius: 20px; text-align: center; width: 80%; border: 1px solid var(--accent); }
        .win-icon { font-size: 60px; margin-bottom: 10px; }
        .win-btns { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-top: 20px; }
        .btn-keep { background: #4cd137; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; }
        .btn-sell { background: #e84118; color: white; border: none; padding: 12px; border-radius: 10px; font-weight: bold; }

        .inventory { width: 100%; margin-top: 20px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .item { background: var(--card); padding: 8px; border-radius: 10px; text-align: center; font-size: 11px; }
    </style>
</head>
<body>

    <div class="header">
        <div id="u-name">–ò–≥—Ä–æ–∫</div>
        <div class="balance-box">‚≠ê <span id="balance">500</span></div>
    </div>

    <div class="chest-container" onclick="openChest()">
        <div class="chest" id="chest-emoji">üéÅ</div>
        <p style="color: gray;">–ù–∞–∂–º–∏ –Ω–∞ —Å—É–Ω–¥—É–∫</p>
    </div>

    <button class="btn-open" onclick="openChest()">–û–¢–ö–†–´–¢–¨ (25 ‚≠ê)</button>

    <div id="modal">
        <div class="win-card">
            <div id="win-label" style="color: var(--accent); margin-bottom: 10px;">–í–´–ü–ê–õ –ü–û–î–ê–†O–ö!</div>
            <div class="win-icon" id="win-icon">üéÅ</div>
            <div id="win-name" style="font-weight: bold; font-size: 20px;">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
            <div id="win-price" style="margin-top: 5px; opacity: 0.8;">–¶–µ–Ω–∞: 0 ‚≠ê</div>
            <div class="win-btns">
                <button class="btn-keep" onclick="keepItem()">–í –ö–û–õ–õ–ï–ö–¶–ò–Æ</button>
                <button class="btn-sell" id="sell-text" onclick="sellItem()">–ü–†–û–î–ê–¢–¨ –ó–ê 0 ‚≠ê</button>
            </div>
        </div>
    </div>

    <div style="margin-top: 30px; font-weight: bold; width: 100%;">–ò–ù–í–ï–ù–¢–ê–†–¨:</div>
    <div class="inventory" id="inventory"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        let balance = parseFloat(localStorage.getItem('stars_26')) || 500;
        let inventory = JSON.parse(localStorage.getItem('inv_26')) || [];
        let lastReward = null;

        function updateUI() {
            document.getElementById('balance').innerText = balance.toFixed(1);
            document.getElementById('inventory').innerHTML = inventory.map(i => `<div class="item"><div>${i.icon}</div>${i.val} ‚≠ê</div>`).join('');
            if (tg.initDataUnsafe?.user) document.getElementById('u-name').innerText = tg.initDataUnsafe.user.first_name;
        }

        function openChest() {
            if (balance < 25) return tg.showAlert("–ú–∞–ª–æ –∑–≤–µ–∑–¥!");
            balance -= 25;
            updateUI();

            const chest = document.getElementById('chest-emoji');
            chest.classList.add('shake');
            tg.HapticFeedback.impactOccurred('heavy');

            setTimeout(() => {
                chest.classList.remove('shake');
                calculateReward();
            }, 1200);
        }

        function calculateReward() {
            const rand = Math.random() * 100;
            let reward = { val: 0, icon: '‚≠ê', name: '–ó–≤–µ–∑–¥—ã' };

            if (rand <= 0.5) { // –î–∂–µ–∫–ø–æ—Ç 0.5%
                reward.val = Math.floor(Math.random() * 2200) + 300;
                reward.icon = 'üèÜ'; reward.name = 'Super NFT';
            } else if (rand <= 15) { // –†–µ–¥–∫–∏–µ
                const rare = [25, 50, 100, 250];
                reward.val = rare[Math.floor(Math.random() * rare.length)];
                reward.icon = 'üíé'; reward.name = 'Rare Star';
            } else { // –û–±—ã—á–Ω—ã–µ
                const common = [1, 5, 10, 20];
                reward.val = common[Math.floor(Math.random() * common.length)];
                reward.icon = '‚≠ê'; reward.name = 'Small Stars';
            }

            lastReward = reward;

            if (reward.val >= 25) {
                // –ï—Å–ª–∏ —Ä–µ–¥–∫–∏–π ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞
                showModal(reward);
            } else {
                // –ï—Å–ª–∏ –¥–µ—à–µ–≤—ã–π ‚Äî –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º –∫ –±–∞–ª–∞–Ω—Å—É
                balance += reward.val;
                tg.showAlert(`–í—ã–ø–∞–ª–æ: ${reward.val} ‚≠ê`);
                updateUI();
            }
        }

        function showModal(item) {
            document.getElementById('win-icon').innerText = item.icon;
            document.getElementById('win-name').innerText = item.name;
            document.getElementById('win-price').innerText = `–°—Ç–æ–∏–º–æ—Å—Ç—å: ${item.val} ‚≠ê`;
            document.getElementById('sell-text').innerText = `–ü–†–û–î–ê–¢–¨ –ó–ê ${item.val} ‚≠ê`;
            document.getElementById('modal').style.display = 'flex';
            tg.HapticFeedback.notificationOccurred('success');
        }

        function keepItem() {
            inventory.unshift(lastReward);
            localStorage.setItem('inv_26', JSON.stringify(inventory));
            closeModal();
        }

        function sellItem() {
            balance += lastReward.val;
            localStorage.setItem('stars_26', balance);
            closeModal();
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            updateUI();
        }

        updateUI();
    </script>
</body>
</html>
