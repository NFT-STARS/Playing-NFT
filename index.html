<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT STARS - Case Simulator</title>
    <script src="https://telegram.org"></script>
    <style>
        :root {
            --bg: #0b0e11;
            --accent: #fcd535;
            --card: #1e2329;
            --common: #848e9c;
            --rare: #3b82f6;
            --jackpot: #ef4444;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: white;
            margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center;
            overflow: hidden; touch-action: manipulation;
        }

        /* –®–∞–ø–∫–∞ */
        .header {
            width: 100%; padding: 20px; box-sizing: border-box;
            display: flex; justify-content: space-between; align-items: center;
            background: rgba(0,0,0,0.2);
        }
        .balance-pill {
            background: var(--card); border: 1px solid var(--accent);
            padding: 8px 15px; border-radius: 20px; font-weight: 800;
        }

        /* –ó–æ–Ω–∞ —Å—É–Ω–¥—É–∫–∞ */
        .game-zone {
            flex: 1; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; width: 100%;
        }

        .chest {
            font-size: 120px; cursor: pointer; transition: 0.3s;
            filter: drop-shadow(0 0 20px rgba(252, 213, 53, 0.2));
        }
        .shake { animation: shakeAnim 0.5s infinite; }
        @keyframes shakeAnim {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1); }
        }

        /* –†—É–ª–µ—Ç–∫–∞ */
        #roulette-container {
            display: none; width: 100%; height: 150px;
            position: relative; overflow: hidden; margin: 20px 0;
            background: rgba(255,255,255,0.03);
            border-top: 2px solid var(--accent); border-bottom: 2px solid var(--accent);
        }
        .pointer {
            position: absolute; left: 50%; top: 0; bottom: 0; width: 4px;
            background: var(--accent); z-index: 5; transform: translateX(-50%);
            box-shadow: 0 0 15px var(--accent);
        }
        #roulette-track {
            display: flex; position: absolute; left: 50%; height: 100%;
            transition: transform 4s cubic-bezier(0.15, 0, 0.05, 1);
        }
        .slot {
            min-width: 120px; height: 150px; display: flex; flex-direction: column;
            align-items: center; justify-content: center; border-right: 1px solid rgba(255,255,255,0.05);
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        .open-btn {
            width: 80%; padding: 20px; margin-bottom: 40px;
            background: var(--accent); color: black; border: none;
            border-radius: 18px; font-size: 20px; font-weight: 900;
            box-shadow: 0 10px 25px rgba(252, 213, 53, 0.3);
        }

        /* –†–µ–∑—É–ª—å—Ç–∞—Ç */
        #result-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.98);
            z-index: 100; flex-direction: column; align-items: center; justify-content: center;
        }
        .win-icon { font-size: 100px; margin-bottom: 20px; animation: popIn 0.5s cubic-bezier(0.17, 0.89, 0.32, 1.49); }
        @keyframes popIn { from { transform: scale(0); } to { transform: scale(1); } }
        
        .modal-btn {
            width: 250px; padding: 15px; margin: 10px; border-radius: 12px;
            border: none; font-weight: bold; font-size: 16px;
        }
    </style>
</head>
<body>

    <div class="header">
        <div id="u-name" style="font-weight: bold;">NFT STARS</div>
        <div class="balance-pill">‚≠ê <span id="balance-val">500</span></div>
    </div>

    <div class="game-zone">
        <div id="chest-ui" style="text-align: center;">
            <div class="chest" id="main-chest" onclick="handleStart()">üéÅ</div>
            <p style="opacity: 0.5; margin-top: 15px;">–ò—Å–ø—ã—Ç–∞–π —É–¥–∞—á—É –≤ 2026!</p>
        </div>

        <div id="roulette-container">
            <div class="pointer"></div>
            <div id="roulette-track"></div>
        </div>
    </div>

    <button class="open-btn" id="btn-main" onclick="handleStart()">–û–¢–ö–†–´–¢–¨ (25 ‚≠ê)</button>

    <div id="result-modal">
        <div class="win-icon" id="res-icon">üåü</div>
        <h1 id="res-name" style="margin: 0;">Rare Gift</h1>
        <p id="res-price" style="font-size: 24px; color: var(--accent);">–¶–µ–Ω–∞: 50 ‚≠ê</p>
        <button class="modal-btn" style="background: #4cd137; color: white;" onclick="actionResult('keep')">–í –ö–û–õ–õ–ï–ö–¶–ò–Æ</button>
        <button class="modal-btn" style="background: #e84118; color: white;" onclick="actionResult('sell')">–ü–†–û–î–ê–¢–¨</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        let balance = parseFloat(localStorage.getItem('stars_2026')) || 500;
        let lastItem = null;

        // –®–∞–Ω—Å—ã –∏ –ø—Ä–µ–¥–º–µ—Ç—ã
        const items = [
            {n: 'Small Pack', i: '‚≠ê', v: 5, p: 0.7},
            {n: 'Big Stars', i: 'üí∞', v: 20, p: 0.15},
            {n: 'Rare NFT', i: 'üíé', v: 100, p: 0.1},
            {n: 'JACKPOT', i: 'üèÜ', v: 1500, p: 0.005} // 0.05% –≤ –ø–µ—Ä–µ—Å—á–µ—Ç–µ –Ω–∞ –ª–æ–≥–∏–∫—É
        ];

        function handleStart() {
            if (balance < 25) { tg.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ó–≤–µ–∑–¥!"); return; }
            balance -= 25;
            updateBalance();

            document.getElementById('btn-main').style.display = 'none';
            const chest = document.getElementById('main-chest');
            chest.classList.add('shake');
            tg.HapticFeedback.impactOccurred('heavy');

            setTimeout(runRoulette, 1200);
        }

        function runRoulette() {
            document.getElementById('chest-ui').style.display = 'none';
            const container = document.getElementById('roulette-container');
            const track = document.getElementById('roulette-track');
            container.style.display = 'block';

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 50 —Å–ª–æ—Ç–æ–≤
            track.innerHTML = '';
            for(let i=0; i<50; i++) {
                const randItem = items[Math.floor(Math.random()*items.length)];
                track.innerHTML += `<div class="slot"><span style="font-size:40px">${randItem.i}</span></div>`;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–∑ –ø–æ —à–∞–Ω—Å–∞–º
            const r = Math.random();
            if(r < 0.005) lastItem = {n: 'MEGA GIFT', i: 'üéÅ', v: Math.floor(Math.random()*2200+300)};
            else if(r < 0.15) lastItem = {n: 'RARE STARS', i: 'üíé', v: [25, 30, 50, 100, 250][Math.floor(Math.random()*5)]};
            else lastItem = {n: 'STARS', i: '‚≠ê', v: [1, 1.5, 5, 10, 15, 20][Math.floor(Math.random()*6)]};

            // –°—Ç–∞–≤–∏–º –ø—Ä–∏–∑ –≤ 45-–π —Å–ª–æ—Ç
            const targetSlot = track.children[44];
            targetSlot.innerHTML = `<span style="font-size:50px">${lastItem.i}</span><div style="font-size:10px">${lastItem.n}</div>`;
            targetSlot.style.color = var(--accent);

            // –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ—â–µ–Ω–∏—è (120px - —à–∏—Ä–∏–Ω–∞ —Å–ª–æ—Ç–∞)
            const offset = 44 * 120;
            setTimeout(() => {
                track.style.transform = `translateX(-${offset}px)`;
            }, 100);

            setTimeout(showResult, 4500);
        }

        function showResult() {
            tg.HapticFeedback.notificationOccurred('success');
            document.getElementById('result-modal').style.display = 'flex';
            document.getElementById('res-icon').innerText = lastItem.i;
            document.getElementById('res-name').innerText = lastItem.n;
            document.getElementById('res-price').innerText = `–¶–µ–Ω–∞: ${lastItem.v} ‚≠ê`;
        }

        function actionResult(type) {
            if (type === 'sell') {
                balance += lastItem.v;
                tg.HapticFeedback.impactOccurred('medium');
            }
            localStorage.setItem('stars_2026', balance);
            location.reload(); // –†–µ—Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        }

        function updateBalance() {
            document.getElementById('balance-val').innerText = balance.toFixed(1);
            localStorage.setItem('stars_2026', balance);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updateBalance();
        if(tg.initDataUnsafe?.user) document.getElementById('u-name').innerText = tg.initDataUnsafe.user.first_name;
    </script>
</body>
</html>
